@using BLL.Common.Extensions
@model BLL.Common.Objects.IHasCommentViewModel
<div ng-controller="CommentsCtrl"
     ng-init='
     itemId=@Model.Id; 
     more=@Model.CommentsCount;
     comments=@Html.Raw(Model.Comments.ToJson());'
     class="mod block">
    <div class="mod__header">
        <div class="mod__header__title">Комментарии</div>
    </div>
    <div class="mod__content comment">
        <div ng-if="more!=0"
             class="text-center">
            <span class="link" ng-click="loadAll();">Показать предыдущие 666 комментариев</span>
        </div>
        <div class="comment__list"
             ng-cloak>
            <div ng-repeat="c in comments" class="cl__it">
                <div ng-attr-id="{{'comment_' + c.id}}"
                     class="cl__it__inner">
                    <div class="cl__it__av-wrap">
                        <img ng-src="{{c.avatar}}" class="cl__it__av" alt="{{c.name}} {{c.surname}}" />
                    </div>
                    <div class="cl__it__info">
                        <div class="cl__it__name">{{c.name}} {{c.surname}}</div>
                        <div class="cl__it__date">{{c.date}}</div>
                        <div ng-click="createAnswer(c)"
                             class="cl__it__text">
                            {{c.text}}
                        </div>
                    </div>
                </div>
                <div ng-if="c.CommentFor != null"
                     class="cl__it__for">
                    Ответ для <span class="link" ng-click="scrollToFor(c.CommentFor.Id)">{{c.commentFor.name}}</span>
                </div>
            </div>
            <form ng-submit="createComment(text)"
                  class="comment__form">
                <textarea ng-model="text"
                          ng-autofocus="{{focus}}"
                          scroll-to-current-pos="{{focus}}"
                          param-dopscroll="100" class="input"></textarea>
                <button type="submit" class="btn">Отправить</button>
            </form>
        </div>
    </div>
</div>